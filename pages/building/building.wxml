<!--pages/building/building.wxml-->
<view class="container">
  <!-- é¡¶éƒ¨æœç´¢æ  -->
  <view class="search-section">
    <view class="search-bar">
      <view class="search-icon">ğŸ”</view>
      <input class="search-input" placeholder="æœç´¢æ¥¼æ ‹åç§°" value="{{searchKeyword}}" bindinput="onSearchInput" />
      <view class="search-clear" wx:if="{{searchKeyword}}" bindtap="clearSearch">âœ•</view>
    </view>
  </view>

  <!-- å½“å‰ä½ç½® -->
  <view class="current-location" wx:if="{{currentBuilding}}">
    <view class="location-header">
      <text class="location-title">å½“å‰ä½ç½®</text>
      <text class="location-refresh" bindtap="refreshLocation">ğŸ”„ åˆ·æ–°</text>
    </view>
    <view class="current-building-card" bindtap="selectBuilding" data-building="{{currentBuilding}}">
      <view class="building-info">
        <view class="building-name">{{currentBuilding.name}}</view>
        <view class="building-detail">
          <text class="building-floors">{{currentBuilding.floors}}å±‚</text>
          <text class="building-washers">{{currentBuilding.washerCount}}å°æ´—è¡£æœº</text>
        </view>
      </view>
      <view class="building-status">
        <view class="status-tag current">å½“å‰</view>
        <view class="status-detail">
          <text class="idle-count">{{currentBuilding.idleCount}}å°ç©ºé—²</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æ”¶è—æ¥¼æ ‹ -->
  <view class="favorite-section" wx:if="{{favoriteBuildings.length > 0}}">
    <view class="section-header">
      <text class="section-title">æ”¶è—æ¥¼æ ‹</text>
    </view>
    <view class="favorite-list">
      <view class="building-card favorite" wx:for="{{favoriteBuildings}}" wx:key="id" bindtap="selectBuilding" data-building="{{item}}">
        <view class="building-info">
          <view class="building-name">{{item.name}}</view>
          <view class="building-detail">
            <text class="building-floors">{{item.floors}}å±‚</text>
            <text class="building-washers">{{item.washerCount}}å°æ´—è¡£æœº</text>
          </view>
        </view>
        <view class="building-status">
          <view class="status-tag favorite-tag">æ”¶è—</view>
          <view class="status-detail">
            <text class="idle-count">{{item.idleCount}}å°ç©ºé—²</text>
          </view>
        </view>
        <view class="favorite-icon" bindtap="removeFavorite" data-building="{{item}}" catchtap="true">â¤ï¸</view>
      </view>
    </view>
  </view>

  <!-- æ‰€æœ‰æ¥¼æ ‹ -->
  <view class="all-buildings-section">
    <view class="section-header">
      <text class="section-title">æ‰€æœ‰æ¥¼æ ‹</text>
    </view>

    <!-- åˆ—è¡¨æ¨¡å¼ -->
    <view class="building-list">
      <view class="building-card" wx:for="{{filteredBuildings}}" wx:key="id" bindtap="selectBuilding" data-building="{{item}}">
        <view class="building-info">
          <view class="building-name">{{item.name}}</view>
          <view class="building-detail">
            <text class="building-floors">{{item.floors}}å±‚</text>
            <text class="building-washers">{{item.washerCount}}å°æ´—è¡£æœº</text>
            <text class="building-distance" wx:if="{{item.distance}}">è·ç¦»{{item.distance}}m</text>
          </view>
        </view>
        <view class="building-status">
          <view class="status-summary">
            <view class="status-item">
              <text class="status-count idle">{{item.idleCount}}</text>
              <text class="status-label">ç©ºé—²</text>
            </view>
            <view class="status-item">
              <text class="status-count working">{{item.workingCount}}</text>
              <text class="status-label">ä½¿ç”¨ä¸­</text>
            </view>
          </view>
          <view class="status-detail">
            <text class="idle-rate">ç©ºé—²ç‡ {{item.idleRate}}%</text>
          </view>
        </view>
        <view class="building-actions">
          <view class="action-btn favorite" bindtap="toggleFavorite" data-building="{{item}}" catchtap="true">
            {{item.isFavorite ? 'â¤ï¸' : 'ğŸ¤'}}
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{filteredBuildings.length === 0 && searchKeyword}}">
    <view class="empty-icon">ğŸ”</view>
    <text class="empty-text">æœªæ‰¾åˆ°ç›¸å…³æ¥¼æ ‹</text>
    <text class="empty-desc">è¯·å°è¯•å…¶ä»–å…³é”®è¯</text>
  </view>
</view>

<!-- æ¥¼æ ‹è¯¦æƒ…å¼¹çª— -->
<view class="building-detail-modal" wx:if="{{showDetailModal}}" bindtap="closeDetailModal">
  <view class="modal-content" catchtap="preventClose">
    <view class="modal-header">
      <text class="modal-title">{{selectedBuilding.name}}</text>
      <view class="modal-close" bindtap="closeDetailModal">âœ•</view>
    </view>
    
    <view class="modal-body">
      <view class="detail-section">
        <view class="detail-title">åŸºæœ¬ä¿¡æ¯</view>
        <view class="detail-item">
          <text class="detail-label">æ¥¼å±‚æ•°ï¼š</text>
          <text class="detail-value">{{selectedBuilding.floors}}å±‚</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">æ´—è¡£æœºæ€»æ•°ï¼š</text>
          <text class="detail-value">{{selectedBuilding.washerCount}}å°</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">å½“å‰ç©ºé—²ï¼š</text>
          <text class="detail-value">{{selectedBuilding.idleCount}}å°</text>
        </view>
      </view>

      <view class="detail-section">
        <view class="detail-title">æ¥¼å±‚åˆ†å¸ƒ</view>
        <view class="floor-list">
          <view class="floor-item" wx:for="{{selectedBuilding.floorDetails}}" wx:key="floor" bindtap="goToFloor" data-floor="{{item.floor}}">
            <view class="floor-info">
              <text class="floor-name">{{item.floor}}æ¥¼</text>
              <text class="floor-washers">{{item.washerCount}}å°æ´—è¡£æœº</text>
            </view>
            <view class="floor-status">
              <text class="floor-idle">{{item.idleCount}}å°ç©ºé—²</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <view class="modal-footer">
      <button class="modal-btn secondary" bindtap="closeDetailModal">å–æ¶ˆ</button>
      <button class="modal-btn primary" bindtap="confirmSelectBuilding">é€‰æ‹©æ­¤æ¥¼æ ‹</button>
    </view>
  </view>
</view>
