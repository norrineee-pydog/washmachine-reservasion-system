<!--pages/my-booking/my-booking.wxml-->
<view class="container">
  <!-- é¡¶éƒ¨å¯¼èˆª -->
  <view class="navbar">
    <view class="navbar-content">
      <view class="navbar-back" bindtap="onBack">
        <text class="back-icon">â€¹</text>
      </view>
      <text class="navbar-title">æˆ‘çš„é¢„çº¦</text>
      <view class="navbar-refresh" bindtap="onRefresh">
        <text class="refresh-icon">â†»</text>
      </view>
    </view>
  </view>

  <!-- çŠ¶æ€ç­›é€‰ -->
  <view class="status-tabs">
    <scroll-view class="tab-scroll" scroll-x>
      <view class="tab-list">
        <view 
          wx:for="{{statusTabs}}" 
          wx:key="key"
          class="tab-item {{filterStatus === item.key ? 'active' : ''}}"
          bindtap="onStatusTabChange"
          data-status="{{item.key}}"
        >
          <text class="tab-text">{{item.name}}</text>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-state" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:elif="{{filteredBookings.length === 0 && !loading}}">
    <view class="empty-icon">ğŸ“…</view>
    <text class="empty-text">{{emptyText}}</text>
    <text class="empty-desc">å¿«å»é¢„çº¦ä¸€å°æ´—è¡£æœºå§</text>
  </view>

  <!-- é¢„çº¦åˆ—è¡¨ -->
  <scroll-view class="booking-list" scroll-y wx:else>
    <view 
      class="booking-item" 
      wx:for="{{filteredBookings}}" 
      wx:key="id"
      bindtap="viewBookingDetail"
      data-booking="{{item}}"
    >
      <view class="booking-header">
        <text class="machine-name">{{item.machineName}}</text>
        <view class="status-tag status-{{item.status}}">
          <text>{{item.statusText}}</text>
        </view>
      </view>
      
      <view class="booking-info">
        <view class="info-item">
          <text class="info-label">ä½ç½®ï¼š</text>
          <text class="info-value">{{item.location}}</text>
        </view>
        <view class="info-item">
          <text class="info-label">ç±»å‹ï¼š</text>
          <text class="info-value">{{item.machineType}}</text>
        </view>
        <view class="info-item">
          <text class="info-label">æ—¶é—´ï¼š</text>
          <text class="info-value">{{item.date}} {{item.time}}</text>
        </view>
        <view class="info-item">
          <text class="info-label">æ—¶é•¿ï¼š</text>
          <text class="info-value">{{item.duration}}åˆ†é’Ÿ</text>
        </view>
      </view>

      <view class="booking-footer">
        <view class="price-section">
          <text class="price-label">é‡‘é¢ï¼š</text>
          <text class="price-value">Â¥{{item.totalPrice || 0}}</text>
        </view>
        
        <view class="action-buttons">
          <!-- å¾…ç¡®è®¤çŠ¶æ€ï¼šå–æ¶ˆæŒ‰é’® -->
          <button 
            class="btn btn-cancel" 
            wx:if="{{item.status === 'pending' && item.paymentStatus === 'unpaid'}}"
            catchtap="cancelBooking"
            data-booking="{{item}}"
          >å–æ¶ˆé¢„çº¦</button>

          <button 
            class="btn btn-pay" 
            wx:if="{{item.paymentStatus === 'unpaid'}}"
            catchtap="payBooking"
            data-booking="{{item}}"
          >æ¨¡æ‹Ÿä»˜æ¬¾</button>

          <button 
            class="btn btn-primary" 
            wx:if="{{item.status === 'confirmed' && item.paymentStatus === 'paid'}}"
            catchtap="startBooking"
            data-booking="{{item}}"
          >å¼€å§‹æ´—è¡£</button>

          <button 
            class="btn btn-success" 
            wx:if="{{item.status === 'working'}}"
            catchtap="completeBooking"
            data-booking="{{item}}"
          >å®Œæˆæ´—è¡£</button>

          <text 
            class="paid-text" 
            wx:if="{{item.status === 'completed'}}"
          >å·²å®Œæˆ</text>
        </view>
      </view>
    </view>
  </scroll-view>

  <!-- åº•éƒ¨å®‰å…¨åŒºåŸŸ -->
  <view class="safe-area"></view>
</view>