<!--pages/index/index.wxml-->
<view class="container">
  <!-- é¡¶éƒ¨æ¬¢è¿åŒºåŸŸ -->
  <view class="welcome-section">
    <view class="welcome-card">
      <view class="welcome-content">
        <view class="welcome-text">
          <text class="welcome-title">æ¬¢è¿ä½¿ç”¨ä¸Šå¤§æ´—è¡£ä¾ </text>
          <text class="welcome-subtitle">{{currentBuilding ? currentBuilding.name : 'æ­£åœ¨å®šä½...'}}</text>
        </view>
        <view class="weather-info" wx:if="{{weather}}">
          <text class="weather-text">{{weather.temp}}Â°C {{weather.desc}}</text>
        </view>
      </view>
      <view class="welcome-avatar">
        <image src="{{userInfo.avatarUrl || '/images/default-avatar.png'}}" class="avatar-img"></image>
      </view>
    </view>
  </view>

  <!-- å¿«é€Ÿæ“ä½œåŒºåŸŸ -->
  <view class="quick-actions">
    <view class="action-item" bindtap="goToBuilding">
      <view class="action-icon building-icon">ğŸ¢</view>
      <text class="action-text">é€‰æ‹©æ¥¼æ ‹</text>
    </view>
    <view class="action-item" bindtap="goToBooking">
      <view class="action-icon booking-icon">ğŸ“…</view>
      <text class="action-text">ç«‹å³é¢„çº¦</text>
    </view>
    <view class="action-item" bindtap="goToMessage">
      <view class="action-icon message-icon">ğŸ’¬</view>
      <text class="action-text">æ¶ˆæ¯ä¸­å¿ƒ</text>
    </view>
    <view class="action-item" bindtap="goToProfile">
      <view class="action-icon profile-icon">ğŸ‘¤</view>
      <text class="action-text">ä¸ªäººä¸­å¿ƒ</text>
    </view>
  </view>

  <!-- å½“å‰æ¥¼æ ‹æ´—è¡£æœºçŠ¶æ€ -->
  <view class="washer-status-section" wx:if="{{currentBuilding}}">
    <view class="section-header">
      <text class="section-title">{{currentBuilding.name}} æ´—è¡£æœºçŠ¶æ€</text>
      <text class="refresh-btn" bindtap="refreshStatus">ğŸ”„ åˆ·æ–°</text>
    </view>
    
    <view class="status-summary">
      <view class="status-item">
        <text class="status-count idle">{{statusSummary.idle}}</text>
        <text class="status-label">ç©ºé—²</text>
      </view>
      <view class="status-item">
        <text class="status-count booking">{{statusSummary.booking}}</text>
        <text class="status-label">é¢„çº¦ä¸­</text>
      </view>
      <view class="status-item">
        <text class="status-count working">{{statusSummary.working}}</text>
        <text class="status-label">å·¥ä½œä¸­</text>
      </view>
      <view class="status-item">
        <text class="status-count ready">{{statusSummary.ready}}</text>
        <text class="status-label">å¾…å–è¡£</text>
      </view>
    </view>

    <!-- æ´—è¡£æœºåˆ—è¡¨ -->
    <view class="washer-list">
      <view class="washer-item" wx:for="{{washerList}}" wx:key="id" bindtap="selectWasher" data-washer="{{item}}">
        <view class="washer-info">
          <view class="washer-name">{{item.name}}</view>
          <view class="washer-location">{{item.location}}</view>
        </view>
        <view class="washer-status">
          <view class="status-tag status-{{item.status}}">{{item.statusText}}</view>
          <view class="status-detail" wx:if="{{item.remainingTime}}">
            <text class="time-text">{{item.remainingTime}}</text>
          </view>
        </view>
        <view class="washer-action">
          <view class="action-btn" wx:if="{{item.status === 'idle'}}">ç«‹å³é¢„çº¦</view>
          <view class="action-btn disabled" wx:else>æš‚ä¸å¯ç”¨</view>
        </view>
      </view>
    </view>
  </view>

  <!-- æ¨èæ—¶æ®µ -->
  <view class="recommendation-section" wx:if="{{recommendations.length > 0}}">
    <view class="section-header">
      <text class="section-title">æ™ºèƒ½æ¨è</text>
    </view>
    <view class="recommendation-list">
      <view class="recommendation-item" wx:for="{{recommendations}}" wx:key="id">
        <view class="recommendation-time">{{item.time}}</view>
        <view class="recommendation-desc">{{item.description}}</view>
        <view class="recommendation-score">
          <text class="score-text">æ¨èåº¦: {{item.score}}%</text>
        </view>
      </view>
    </view>
  </view>

  <!-- å…¬å‘Šä¿¡æ¯ -->
  <view class="notice-section" wx:if="{{notices.length > 0}}">
    <view class="section-header">
      <text class="section-title">ç³»ç»Ÿå…¬å‘Š</text>
    </view>
    <view class="notice-list">
      <view class="notice-item" wx:for="{{notices}}" wx:key="id" bindtap="viewNotice" data-notice="{{item}}">
        <view class="notice-content">
          <text class="notice-title">{{item.title}}</text>
          <text class="notice-time">{{item.time}}</text>
        </view>
        <view class="notice-arrow">></view>
      </view>
    </view>
  </view>
</view>

<!-- åŠ è½½çŠ¶æ€ -->
<view class="loading" wx:if="{{loading}}">
  <view class="loading-spinner"></view>
  <text class="loading-text">åŠ è½½ä¸­...</text>
</view>
