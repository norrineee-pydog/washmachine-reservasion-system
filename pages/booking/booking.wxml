<!--pages/booking/booking.wxml-->
<view class="container">
  <!-- å½“å‰é¢„çº¦çŠ¶æ€ -->
  <view class="current-booking" wx:if="{{currentBooking}}">
    <view class="booking-card active">
      <view class="booking-header">
        <view class="booking-status">
          <view class="status-icon">â°</view>
          <text class="status-text">{{currentBooking.statusText}}</text>
        </view>
        <view class="booking-time">{{currentBooking.remainingTime}}</view>
      </view>
      
      <view class="booking-info">
        <view class="booking-detail">
          <text class="detail-label">æ¥¼æ ‹ï¼š</text>
          <text class="detail-value">{{currentBooking.buildingName}}</text>
        </view>
        <view class="booking-detail">
          <text class="detail-label">æ´—è¡£æœºï¼š</text>
          <text class="detail-value">{{currentBooking.washerName}}</text>
        </view>
        <view class="booking-detail">
          <text class="detail-label">é¢„çº¦æ—¶é—´ï¼š</text>
          <text class="detail-value">{{currentBooking.bookingTime}}</text>
        </view>
      </view>
      
      <view class="booking-actions">
        <button class="action-btn secondary" bindtap="cancelBooking">å–æ¶ˆé¢„çº¦</button>
        <button class="action-btn primary" bindtap="viewBookingDetail">æŸ¥çœ‹è¯¦æƒ…</button>
      </view>
    </view>
  </view>

  <!-- å¿«é€Ÿé¢„çº¦ -->
  <view class="quick-booking-section">
    <view class="section-header">
      <text class="section-title">å¿«é€Ÿé¢„çº¦</text>
      <text class="section-subtitle">é€‰æ‹©å½“å‰ç©ºé—²çš„æ´—è¡£æœº</text>
    </view>
    
    <view class="quick-options">
      <view class="option-item" bindtap="quickBook" data-type="immediate">
        <view class="option-icon immediate">âš¡</view>
        <text class="option-text">ç«‹å³é¢„çº¦</text>
        <text class="option-desc">{{availableWasherCount}}å°å¯ç”¨</text>
      </view>
      <view class="option-item" bindtap="quickBook" data-type="schedule">
        <view class="option-icon schedule">ğŸ“…</view>
        <text class="option-text">æ—¶æ®µé¢„çº¦</text>
        <text class="option-desc">é¢„çº¦æœªæ¥æ—¶æ®µ</text>
      </view>
    </view>
  </view>

  <!-- æ¨èæ—¶æ®µ -->
  <view class="recommendation-section" wx:if="{{recommendations.length > 0}}">
    <view class="section-header">
      <text class="section-title">æ™ºèƒ½æ¨è</text>
      <text class="section-subtitle">åŸºäºå†å²æ•°æ®æ¨èæœ€ä½³æ—¶æ®µ</text>
    </view>
    
    <view class="recommendation-list">
      <view class="recommendation-item" wx:for="{{recommendations}}" wx:key="id" bindtap="selectRecommendation" data-recommendation="{{item}}">
        <view class="recommendation-time">
          <text class="time-text">{{item.time}}</text>
          <text class="time-desc">{{item.date}}</text>
        </view>
        <view class="recommendation-info">
          <view class="recommendation-score">
            <text class="score-text">æ¨èåº¦ {{item.score}}%</text>
            <view class="score-bar">
              <view class="score-fill" style="width: {{item.score}}%"></view>
            </view>
          </view>
          <text class="recommendation-desc">{{item.description}}</text>
        </view>
        <view class="recommendation-action">
          <view class="action-btn small">é¢„çº¦</view>
        </view>
      </view>
    </view>
  </view>

  <!-- é¢„çº¦å†å² -->
  <view class="history-section">
    <view class="section-header">
      <text class="section-title">é¢„çº¦å†å²</text>
      <text class="view-all" bindtap="viewAllHistory">æŸ¥çœ‹å…¨éƒ¨</text>
    </view>
    
    <view class="history-list">
      <view class="history-item" wx:for="{{bookingHistory}}" wx:key="id" bindtap="viewHistoryDetail" data-booking="{{item}}">
        <view class="history-info">
          <view class="history-time">{{item.bookingTime}}</view>
          <view class="history-detail">
            <text class="detail-text">{{item.buildingName}} {{item.washerName}}</text>
            <text class="status-tag status-{{item.status}}">{{item.statusText}}</text>
          </view>
        </view>
        <view class="history-arrow">></view>
      </view>
    </view>
  </view>

  <!-- ä½¿ç”¨ç»Ÿè®¡ -->
  <view class="statistics-section">
    <view class="section-header">
      <text class="section-title">ä½¿ç”¨ç»Ÿè®¡</text>
    </view>
    
    <view class="statistics-grid">
      <view class="stat-item">
        <text class="stat-number">{{statistics.totalBookings}}</text>
        <text class="stat-label">æ€»é¢„çº¦æ¬¡æ•°</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{statistics.successRate}}%</text>
        <text class="stat-label">æˆåŠŸç‡</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{statistics.avgWaitTime}}</text>
        <text class="stat-label">å¹³å‡ç­‰å¾…</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{statistics.creditScore}}</text>
        <text class="stat-label">ä¿¡ç”¨ç§¯åˆ†</text>
      </view>
    </view>
  </view>
</view>

<!-- æ—¶æ®µé€‰æ‹©å¼¹çª— -->
<view class="time-picker-modal" wx:if="{{showTimePicker}}" bindtap="closeTimePicker">
  <view class="modal-content" catchtap="preventClose">
    <view class="modal-header">
      <text class="modal-title">é€‰æ‹©é¢„çº¦æ—¶æ®µ</text>
      <view class="modal-close" bindtap="closeTimePicker">âœ•</view>
    </view>
    
    <view class="modal-body">
      <view class="date-picker">
        <view class="date-item {{selectedDate === item ? 'active' : ''}}" 
              wx:for="{{availableDates}}" 
              wx:key="date" 
              bindtap="selectDate" 
              data-date="{{item}}">
          <text class="date-text">{{item.dateText}}</text>
          <text class="date-desc">{{item.dayText}}</text>
        </view>
      </view>
      
      <view class="time-slots">
        <view class="time-slot {{slot.available ? 'available' : 'unavailable'}} {{selectedTimeSlot === slot ? 'selected' : ''}}"
              wx:for="{{timeSlots}}" 
              wx:key="id" 
              bindtap="selectTimeSlot" 
              data-slot="{{slot}}">
          <text class="slot-time">{{slot.time}}</text>
          <text class="slot-status">{{slot.available ? 'å¯é¢„çº¦' : 'å·²æ»¡'}}</text>
        </view>
      </view>
    </view>
    
    <view class="modal-footer">
      <button class="modal-btn secondary" bindtap="closeTimePicker">å–æ¶ˆ</button>
      <button class="modal-btn primary" bindtap="confirmTimeBooking" disabled="{{!selectedTimeSlot}}">ç¡®è®¤é¢„çº¦</button>
    </view>
  </view>
</view>

<!-- æ´—è¡£æœºé€‰æ‹©å¼¹çª— -->
<view class="washer-picker-modal" wx:if="{{showWasherPicker}}" bindtap="closeWasherPicker">
  <view class="modal-content" catchtap="preventClose">
    <view class="modal-header">
      <text class="modal-title">é€‰æ‹©æ´—è¡£æœº</text>
      <view class="modal-close" bindtap="closeWasherPicker">âœ•</view>
    </view>
    
    <view class="modal-body">
      <view class="washer-list" wx:if="{{availableWashers.length > 0}}">
        <view class="washer-item {{washer.status === 'idle' ? 'available' : 'unavailable'}}"
              wx:for="{{availableWashers}}" 
              wx:key="id" 
              bindtap="selectWasher" 
              data-washer="{{washer}}">
          <view class="washer-info">
            <text class="washer-name">{{washer.name}}</text>
            <text class="washer-location">{{washer.location}}</text>
          </view>
          <view class="washer-status">
            <view class="status-tag status-{{washer.status}}">{{washer.statusText}}</view>
            <text class="washer-distance" wx:if="{{washer.distance}}">è·ç¦»{{washer.distance}}m</text>
          </view>
        </view>
      </view>
      <view class="empty-state" wx:else>
        <view class="empty-icon">ğŸ§º</view>
        <text class="empty-text">æš‚æ—¶æ²¡æœ‰å¯ç”¨çš„æ´—è¡£æœº</text>
      </view>
    </view>
    
    <view class="modal-footer">
      <button class="modal-btn secondary" bindtap="closeWasherPicker">å–æ¶ˆ</button>
      <button class="modal-btn primary" bindtap="confirmWasherBooking" disabled="{{!selectedWasher}}">ç¡®è®¤é¢„çº¦</button>
    </view>
  </view>
</view>
